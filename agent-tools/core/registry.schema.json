{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Agent Tools Registry Schema v3",
  "description": "Schema for the agent tools registry with progressive disclosure support",
  "type": "object",
  "required": ["version", "primitives"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Registry version"
    },
    "lastUpdated": {
      "type": "string",
      "format": "date-time",
      "description": "Last update timestamp"
    },
    "primitives": {
      "type": "object",
      "description": "Organized by primitive categories",
      "additionalProperties": {
        "$ref": "#/definitions/capability"
      }
    },
    "workflows": {
      "type": "object",
      "description": "Multi-step workflows (simple and complex)",
      "additionalProperties": {
        "$ref": "#/definitions/capability"
      }
    },
    "schemas": {
      "type": "object",
      "description": "Data schemas",
      "additionalProperties": {
        "$ref": "#/definitions/schemaReference"
      }
    }
  },
  "definitions": {
    "capability": {
      "type": "object",
      "required": ["description", "tools"],
      "properties": {
        "description": {
          "type": "string"
        },
        "tools": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/tool"
          }
        }
      }
    },
    "tool": {
      "type": "object",
      "required": ["id", "path"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique tool identifier (e.g., 'instagram.extract-post', 'browser.start')"
        },
        "when": {
          "type": "string",
          "description": "Use case description for agent matching (e.g., 'Extract single Instagram post with metadata')"
        },
        "path": {
          "type": "string",
          "description": "Relative path from agent-tools root"
        },
        "category": {
          "type": "string",
          "description": "Tool category (e.g., 'instagram', 'media', 'browser')"
        },
        "complexity": {
          "type": "string",
          "enum": ["low", "medium", "high"],
          "description": "Workflow complexity: low (minutes), medium (10-30min), high (hours/days)"
        },
        "resumable": {
          "type": "boolean",
          "description": "Whether the workflow supports --resume flag",
          "default": false
        },
        "runtime": {
          "type": "string",
          "description": "Estimated runtime (e.g., '1-2min', '10-30min', 'hours')"
        },
        "features": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Workflow features (e.g., 'resume', 'checkpoint', 'progress-tracking')"
        },
        "flags": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Command-line flags accepted (e.g., 'url', 'profile', 'resume')"
        },
        "composes": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Other tools/workflows composed by this workflow"
        },
        "capabilities": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of capabilities this tool provides"
        },
        "inputs": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Expected input parameter names"
        },
        "outputs": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Output field names produced"
        },
        "dependencies": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "NPM dependencies"
        },
        "systemDependencies": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "System-level dependencies"
        },
        "envVars": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Required environment variables"
        }
      }
    },
    "schemaReference": {
      "type": "object",
      "required": ["path"],
      "properties": {
        "path": {
          "type": "string"
        },
        "description": {
          "type": "string"
        }
      }
    }
  }
}
